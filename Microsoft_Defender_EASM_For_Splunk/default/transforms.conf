# default/transforms.conf
# Microsoft Defender EASM for Splunk App
#
# Purpose:
# - Normalize key identifiers
# - Enable lightweight joins and drilldowns
# - Avoid field invention or enrichment
#
# Source of truth:
# https://learn.microsoft.com/en-us/rest/api/defenderforeasm/
###############################################################################

########################################
# GENERIC OBJECT ID (TOP-LEVEL ONLY)
########################################

[easm_id]
REGEX = \"id\"\s*:\s*\"(/subscriptions/[^\"]+)\"
DEST_KEY = easm_id
FORMAT = $1

########################################
# ASSET TYPE
########################################

[easm_asset_type]
REGEX = \"assetType\"\s*:\s*\"([^\"]+)\"
DEST_KEY = asset_type
FORMAT = $1

########################################
# DOMAIN OBJECTS
########################################

[easm_domain]
REGEX = \"domain\"\s*:\s*\"([^\"]+)\"
DEST_KEY = domain
FORMAT = $1

########################################
# HOST OBJECTS
########################################

[easm_host]
REGEX = \"hostName\"\s*:\s*\"([^\"]+)\"
DEST_KEY = host
FORMAT = $1

########################################
# IP ADDRESS OBJECTS
########################################

[easm_ip_address]
REGEX = \"ipAddress\"\s*:\s*\"([^\"]+)\"
DEST_KEY = ip_address
FORMAT = $1

########################################
# ASN OBJECTS
########################################

[easm_asn]
REGEX = \"asn\"\s*:\s*(\d+)
DEST_KEY = asn
FORMAT = $1

########################################
# SSL CERTIFICATES
########################################

[easm_cert_fingerprint]
REGEX = \"fingerprint\"\s*:\s*\"([^\"]+)\"
DEST_KEY = ssl_fingerprint
FORMAT = $1

########################################
# WHOIS CONTACTS
########################################

[easm_whois_email]
REGEX = \"email\"\s*:\s*\"([^\"]+)\"
DEST_KEY = whois_email
FORMAT = $1

########################################
# TASK / DISCOVERY OBJECTS
########################################

[easm_task_id]
REGEX = \"taskId\"\s*:\s*\"([^\"]+)\"
DEST_KEY = task_id
FORMAT = $1

########################################
# SEVERITY / RISK (ONLY WHEN PRESENT)
########################################

[easm_severity]
REGEX = \"severity\"\s*:\s*\"([^\"]+)\"
DEST_KEY = severity
FORMAT = $1

[easm_risk_level]
REGEX = \"riskLevel\"\s*:\s*\"([^\"]+)\"
DEST_KEY = risk_level
FORMAT = $1
