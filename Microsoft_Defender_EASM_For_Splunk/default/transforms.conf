# default/transforms.conf
# Microsoft Defender EASM for Splunk App
#
# Purpose:
# - Normalize common EASM object IDs
# - Support relationship-style lookups
# - Enable future joins across assets without inventing fields
#
# Source of truth:
# https://learn.microsoft.com/en-us/rest/api/defenderforeasm/

########################################
# GENERIC ID NORMALIZATION
########################################

[easm_id_kv]
REGEX = \"id\"\s*:\s*\"(?<easm_id>[^\"]+)\"
FORMAT = easm_id::$1
WRITE_META = true

########################################
# ASSET TYPE EXTRACTION
########################################

[easm_asset_type]
REGEX = \"assetType\"\s*:\s*\"(?<asset_type>[^\"]+)\"
FORMAT = asset_type::$1
WRITE_META = true

########################################
# DOMAIN OBJECTS
########################################

[easm_domain_name]
REGEX = \"domain\"\s*:\s*\"(?<domain>[^\"]+)\"
FORMAT = domain::$1
WRITE_META = true

########################################
# HOST OBJECTS
########################################

[easm_hostname]
REGEX = \"hostName\"\s*:\s*\"(?<host_name>[^\"]+)\"
FORMAT = host_name::$1
WRITE_META = true

########################################
# IP ADDRESS OBJECTS
########################################

[easm_ip_address]
REGEX = \"ipAddress\"\s*:\s*\"(?<ip_address>[^\"]+)\"
FORMAT = ip_address::$1
WRITE_META = true

########################################
# ASN OBJECTS
########################################

[easm_asn]
REGEX = \"asn\"\s*:\s*(?<asn>\d+)
FORMAT = asn::$1
WRITE_META = true

########################################
# SSL CERTIFICATES
########################################

[easm_cert_fingerprint]
REGEX = \"fingerprint\"\s*:\s*\"(?<cert_fingerprint>[^\"]+)\"
FORMAT = cert_fingerprint::$1
WRITE_META = true

########################################
# WHOIS CONTACTS
########################################

[easm_whois_email]
REGEX = \"email\"\s*:\s*\"(?<whois_email>[^\"]+)\"
FORMAT = whois_email::$1
WRITE_META = true

########################################
# DISCOVERY / TASK OBJECTS
########################################

[easm_task_id]
REGEX = \"taskId\"\s*:\s*\"(?<task_id>[^\"]+)\"
FORMAT = task_id::$1
WRITE_META = true

########################################
# SEVERITY / RISK (ONLY IF PRESENT)
########################################

[easm_severity]
REGEX = \"severity\"\s*:\s*\"(?<severity>[^\"]+)\"
FORMAT = severity::$1
WRITE_META = true

[easm_risk_level]
REGEX = \"riskLevel\"\s*:\s*\"(?<risk_level>[^\"]+)\"
FORMAT = risk_level::$1
WRITE_META = true
