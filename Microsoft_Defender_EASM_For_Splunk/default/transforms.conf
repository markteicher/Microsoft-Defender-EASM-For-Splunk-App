# default/transforms.conf
# Microsoft Defender EASM for Splunk App
###############################################################################

########################################
# CANONICAL EASM RESOURCE ID
########################################

[easm_id]
REGEX = \"id\"\s*:\s*\"(/subscriptions/[^\"]+)\"
DEST_KEY = easm_id
FORMAT = $1

########################################
# ASSET TYPE (WHEN NOT FLATTENED)
########################################

[easm_asset_type]
REGEX = \"assetType\"\s*:\s*\"([^\"]+)\"
DEST_KEY = asset_type
FORMAT = $1

########################################
# DOMAIN NAME (NESTED PAYLOADS)
########################################

[easm_domain]
REGEX = \"domain\"\s*:\s*\"([^\"]+)\"
DEST_KEY = domain
FORMAT = $1

########################################
# HOST NAME (DISCOVERY / TASK PAYLOADS)
########################################

[easm_host]
REGEX = \"hostName\"\s*:\s*\"([^\"]+)\"
DEST_KEY = host
FORMAT = $1

########################################
# IP ADDRESS (EXPOSURE / FINDINGS)
########################################

[easm_ip_address]
REGEX = \"ipAddress\"\s*:\s*\"([^\"]+)\"
DEST_KEY = ip_address
FORMAT = $1

########################################
# ASN (NUMERIC)
########################################

[easm_asn]
REGEX = \"asn\"\s*:\s*(\d+)
DEST_KEY = asn
FORMAT = $1

########################################
# SSL CERTIFICATE FINGERPRINT
########################################

[easm_cert_fingerprint]
REGEX = \"fingerprint\"\s*:\s*\"([^\"]+)\"
DEST_KEY = ssl_fingerprint
FORMAT = $1

########################################
# WHOIS EMAIL (NESTED CONTACT OBJECTS)
########################################

[easm_whois_email]
REGEX = \"email\"\s*:\s*\"([^\"]+)\"
DEST_KEY = whois_email
FORMAT = $1

########################################
# DNS RECORDS
########################################

[easm_dns_name]
REGEX = \"name\"\s*:\s*\"([^\"]+)\"
DEST_KEY = dns_name
FORMAT = $1

[easm_dns_record_type]
REGEX = \"recordType\"\s*:\s*\"([^\"]+)\"
DEST_KEY = dns_record_type
FORMAT = $1

[easm_dns_record_value]
REGEX = \"value\"\s*:\s*\"([^\"]+)\"
DEST_KEY = dns_record_value
FORMAT = $1

[easm_dns_ttl]
REGEX = \"ttl\"\s*:\s*(\d+)
DEST_KEY = dns_ttl
FORMAT = $1

########################################
# SEVERITY / RISK (ONLY IF PRESENT)
########################################

[easm_severity]
REGEX = \"severity\"\s*:\s*\"([^\"]+)\"
DEST_KEY = severity
FORMAT = $1

[easm_risk_level]
REGEX = \"riskLevel\"\s*:\s*\"([^\"]+)\"
DEST_KEY = risk_level
FORMAT = $1
