<!--
  File: defender_easm_operations.xml
  Microsoft Defender EASM for Splunk App

  Dashboard: Operations
  Purpose: Control Plane & Data Plane operation visibility
-->

<dashboard version="1.1" theme="light">
  <label>⚙️ Operations</label>

  <description>
    Control plane and data-plane operations supported by Microsoft Defender
    External Attack Surface Management. Derived from the Operations API.
  </description>

  <!-- ========================= -->
  <!-- BASE SEARCH -->
  <!-- ========================= -->
  <search id="base_operations">
    <query>
      `easm_index`
      sourcetype=defender:easm:operations
      | eval action_type=if(isDataAction=true,"Data Action","Control Plane Action")
    </query>
    <earliest>-30d@d</earliest>
    <latest>now</latest>
  </search>

  <!-- ========================= -->
  <!-- OPERATIONS OVERVIEW -->
  <!-- ========================= -->
  <row>
    <panel>
      <title>Operation Types</title>
      <chart>
        <search base="base_operations">
          <query>
            | stats count by action_type
          </query>
        </search>
        <option name="charting.chart">pie</option>
        <option name="charting.legend.placement">right</option>
      </chart>
    </panel>
  </row>

  <!-- ========================= -->
  <!-- OPERATIONS TABLE -->
  <!-- ========================= -->
  <row>
    <panel>
      <title>Available EASM Operations</title>
      <table>
        <search base="base_operations">
          <query>
            | table
                name
                display.provider
                display.resource
                display.operation
                display.description
                isDataAction
            | rename
                display.provider AS provider
                display.resource AS resource
                display.operation AS operation
                display.description AS description
            | sort provider resource operation
          </query>
        </search>
        <option name="wrap">true</option>
        <option name="count">25</option>
      </table>
    </panel>
  </row>

  <!-- ========================= -->
  <!-- OPERATION COVERAGE -->
  <!-- ========================= -->
  <row>
    <panel>
      <title>Operation Coverage by Resource</title>
      <chart>
        <search base="base_operations">
          <query>
            | stats count by display.resource
            | rename display.resource AS resource
            | sort - count
          </query>
        </search>
        <option name="charting.chart">bar</option>
        <option name="charting.axisTitleX.text">Resource Type</option>
        <option name="charting.axisTitleY.text">Operation Count</option>
        <option name="charting.legend.placement">none</option>
      </chart>
    </panel>
  </row>

</dashboard>
