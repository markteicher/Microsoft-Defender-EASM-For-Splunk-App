<!--
defender_easm_data_connections.xml
Microsoft Defender EASM for Splunk App
Manage â†’ Data Connections
-->

<dashboard>
  <label>Data Connections</label>
  <description>Visibility into Microsoft Defender EASM data connections, ingestion state, frequency, and operational health.</description>

  <!-- ========================= -->
  <!-- GLOBAL TIME PICKER        -->
  <!-- ========================= -->
  <fieldset submitButton="false">
    <input type="time">
      <label>Time Range</label>
      <default>
        <earliest>-30d@d</earliest>
        <latest>now</latest>
      </default>
    </input>
  </fieldset>

  <!-- ========================= -->
  <!-- KPI ROW                   -->
  <!-- ========================= -->
  <row>
    <panel>
      <single>
        <title>Total Data Connections</title>
        <search>
          <query>
            index=security_defender_easm sourcetype=defender:easm:data_connections
            | stats dc(connection_id) AS total
          </query>
        </search>
        <option name="unit">connections</option>
      </single>
    </panel>

    <panel>
      <single>
        <title>Connected</title>
        <search>
          <query>
            index=security_defender_easm sourcetype=defender:easm:data_connections status=Connected
            | stats count
          </query>
        </search>
      </single>
    </panel>

    <panel>
      <single>
        <title>Disconnected</title>
        <search>
          <query>
            index=security_defender_easm sourcetype=defender:easm:data_connections status=Disconnected
            | stats count
          </query>
        </search>
      </single>
    </panel>

    <panel>
      <single>
        <title>Errors (Last 24h)</title>
        <search>
          <query>
            index=security_defender_easm sourcetype=defender:easm:data_connections error=*
            | where _time &gt; relative_time(now(), "-24h")
            | stats count
          </query>
        </search>
      </single>
    </panel>
  </row>

  <!-- ========================= -->
  <!-- CONNECTION STATUS TABLE   -->
  <!-- ========================= -->
  <row>
    <panel>
      <title>Data Connection Inventory</title>
      <table>
        <search>
          <query>
            index=security_defender_easm sourcetype=defender:easm:data_connections
            | stats latest(status) AS status
                    latest(type) AS type
                    latest(frequency) AS frequency
                    latest(content) AS content
                    latest(workspace_id) AS workspace_id
                    latest(created_time) AS created
                    latest(updated_time) AS updated
                    by connection_name
          </query>
        </search>
        <option name="count">20</option>
      </table>
    </panel>
  </row>

  <!-- ========================= -->
  <!-- INGESTION FREQUENCY       -->
  <!-- ========================= -->
  <row>
    <panel>
      <title>Ingestion Frequency Distribution</title>
      <chart>
        <search>
          <query>
            index=security_defender_easm sourcetype=defender:easm:data_connections
            | stats count by frequency
          </query>
        </search>
        <option name="charting.chart">pie</option>
      </chart>
    </panel>

    <panel>
      <title>Connection Types</title>
      <chart>
        <search>
          <query>
            index=security_defender_easm sourcetype=defender:easm:data_connections
            | stats count by type
          </query>
        </search>
        <option name="charting.chart">bar</option>
      </chart>
    </panel>
  </row>

  <!-- ========================= -->
  <!-- OPERATIONAL TIMELINE      -->
  <!-- ========================= -->
  <row>
    <panel>
      <title>Connection State Changes Over Time</title>
      <chart>
        <search>
          <query>
            index=security_defender_easm sourcetype=defender:easm:data_connections
            | timechart span=1d count by status
          </query>
        </search>
        <option name="charting.chart">line</option>
      </chart>
    </panel>
  </row>

  <!-- ========================= -->
  <!-- TROUBLESHOOTING           -->
  <!-- ========================= -->
  <row>
    <panel>
      <title>Recent Connection Errors</title>
      <table>
        <search>
          <query>
            index=security_defender_easm sourcetype=defender:easm:data_connections error=*
            | table _time connection_name status error message
            | sort -_time
          </query>
        </search>
        <option name="count">10</option>
      </table>
    </panel>
  </row>

</dashboard>
