<!-- default/data/ui/views/defender_easm_data_connections.xml -->
<!-- Microsoft Defender EASM for Splunk App -->
<!-- Data Connections â€“ aligned to Defender EASM data-plane API -->

<dashboard version="1.1">
  <label>Data Connections</label>

  <description>
    Operational view of Microsoft Defender EASM data-plane connections,
    including connection type, provisioning state, cadence, and health.
  </description>

  <!-- ========================= -->
  <!-- BASE SEARCH -->
  <!-- ========================= -->
  <search id="base_data_connections">
    <query>
      `easm_index`
      sourcetype=defender:easm:data_connection
      | eval createdTime=strftime(createdTime,"%Y-%m-%d %H:%M:%S")
      | eval lastModifiedTime=strftime(lastModifiedTime,"%Y-%m-%d %H:%M:%S")
      | eval lastSyncTime=strftime(lastSyncTime,"%Y-%m-%d %H:%M:%S")
    </query>
    <earliest>-24h</earliest>
    <latest>now</latest>
  </search>

  <!-- ========================= -->
  <!-- KPI ROW -->
  <!-- ========================= -->
  <row>
    <panel>
      <single>
        <title>Total Data Connections</title>
        <search base="base_data_connections">
          <query>
            | stats count
          </query>
        </search>
      </single>
    </panel>

    <panel>
      <single>
        <title>Provisioned</title>
        <search base="base_data_connections">
          <query>
            | search provisioningState="Succeeded"
            | stats count
          </query>
        </search>
      </single>
    </panel>

    <panel>
      <single>
        <title>Failed / In Progress</title>
        <search base="base_data_connections">
          <query>
            | search provisioningState!="Succeeded"
            | stats count
          </query>
        </search>
      </single>
    </panel>
  </row>

  <!-- ========================= -->
  <!-- DATA CONNECTION INVENTORY -->
  <!-- ========================= -->
  <row>
    <panel>
      <title>Data Connection Inventory</title>

      <table>
        <search base="base_data_connections">
          <query>
            | table
                name
                type
                provisioningState
                connectionType
                cadence
                lastSyncTime
                createdTime
                lastModifiedTime
            | sort name
          </query>
        </search>

        <option name="count">20</option>
        <option name="wrap">true</option>

        <drilldown>
          <set token="connection_name">$row.name$</set>
        </drilldown>
      </table>
    </panel>
  </row>

  <!-- ========================= -->
  <!-- CONNECTION DETAIL -->
  <!-- ========================= -->
  <row>
    <panel>
      <title>Connection Details: $connection_name$</title>

      <table>
        <search base="base_data_connections">
          <query>
            | search name="$connection_name$"
            | transpose
            | rename column as Field, row 1 as Value
          </query>
        </search>

        <option name="count">25</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>

</dashboard>
