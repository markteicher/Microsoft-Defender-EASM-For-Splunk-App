<!-- defender_easm_report_execution_duration.xml -->
<!-- Microsoft Defender EASM for Splunk App -->
<!-- Dashboard: Report Execution Duration -->

<dashboard version="1.1">
  <label>Report Execution Duration</label>

  <description>
    Execution timing and duration analysis for Microsoft Defender EASM reports.
    Highlights long-running, slow, and failed report executions.
  </description>

  <!-- ========================= -->
  <!-- TIME RANGE -->
  <!-- ========================= -->

  <fieldset submitButton="false">
    <input type="time" token="time">
      <label>Time Range</label>
      <default>
        <earliest>-30d@d</earliest>
        <latest>now</latest>
      </default>
    </input>
  </fieldset>

  <!-- ========================= -->
  <!-- BASE SEARCH -->
  <!-- ========================= -->

  <search id="base_reports">
    <query>
      `easm_index`
      sourcetype=defender:easm:report
      | eval created_epoch=strptime(created_time,"%Y-%m-%dT%H:%M:%S")
      | eval completed_epoch=strptime(completed_time,"%Y-%m-%dT%H:%M:%S")
      | eval duration_seconds=completed_epoch-created_epoch
      | eval duration_minutes=round(duration_seconds/60,2)
    </query>
    <earliest>$time.earliest$</earliest>
    <latest>$time.latest$</latest>
  </search>

  <!-- ========================= -->
  <!-- EXECUTION TABLE -->
  <!-- ========================= -->

  <row>
    <panel>
      <title>Report Execution Durations</title>
      <table>
        <search base="base_reports">
          <query>
            | table
                report_id
                report_name
                report_type
                status
                created_time
                completed_time
                duration_minutes
            | sort - duration_minutes
          </query>
        </search>
        <option name="count">10</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>

  <!-- ========================= -->
  <!-- LONG-RUNNING REPORTS -->
  <!-- ========================= -->

  <row>
    <panel>
      <title>Longest Running Reports (Top 10)</title>
      <chart>
        <search base="base_reports">
          <query>
            | stats max(duration_minutes) AS max_duration BY report_name
            | sort - max_duration
            | head 10
          </query>
        </search>
        <option name="charting.chart">bar</option>
        <option name="charting.axisTitleX.text">Report Name</option>
        <option name="charting.axisTitleY.text">Duration (Minutes)</option>
        <option name="charting.legend.placement">none</option>
      </chart>
    </panel>
  </row>

  <!-- ========================= -->
  <!-- STATUS BREAKDOWN -->
  <!-- ========================= -->

  <row>
    <panel>
      <title>Execution Status Breakdown</title>
      <chart>
        <search base="base_reports">
          <query>
            | stats count BY status
          </query>
        </search>
        <option name="charting.chart">pie</option>
        <option name="charting.legend.placement">right</option>
      </chart>
    </panel>
  </row>

</dashboard>
