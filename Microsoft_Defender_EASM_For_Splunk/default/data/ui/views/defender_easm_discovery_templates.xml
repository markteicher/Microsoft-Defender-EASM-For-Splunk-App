<!-- defender_easm_discovery_templates.xml -->
<!-- Microsoft Defender EASM for Splunk App -->
<!-- Dashboard: Discovery Templates -->

<dashboard version="1.1">
  <label>Discovery Templates</label>
  <description>
    Inventory and visibility of Microsoft Defender EASM discovery templates
    collected from the data-plane discovery-templates API.
  </description>

  <!-- Summary -->
  <row>
    <panel>
      <title>Discovery Template Summary</title>
      <table>
        <search>
          <query>
            index=security_defender_easm sourcetype=defender:easm:discovery_template
            | stats
                count as total_templates
                by provisioning_state
          </query>
          <earliest>-30d</earliest>
          <latest>now</latest>
        </search>
        <option name="count">10</option>
      </table>
    </panel>
  </row>

  <!-- Template Inventory -->
  <row>
    <panel>
      <title>Discovery Template Inventory</title>
      <table>
        <search>
          <query>
            index=security_defender_easm sourcetype=defender:easm:discovery_template
            | table
                template_name
                template_type
                provisioning_state
                created_time
                last_modified_time
                created_by
                modified_by
            | sort template_name
          </query>
          <earliest>-90d</earliest>
          <latest>now</latest>
        </search>
        <option name="count">20</option>
      </table>
    </panel>
  </row>

  <!-- Template Types -->
  <row>
    <panel>
      <title>Templates by Type</title>
      <chart>
        <search>
          <query>
            index=security_defender_easm sourcetype=defender:easm:discovery_template
            | stats count by template_type
            | sort - count
          </query>
          <earliest>-90d</earliest>
          <latest>now</latest>
        </search>
        <option name="charting.chart">pie</option>
        <option name="charting.legend.placement">right</option>
      </chart>
    </panel>
  </row>

  <!-- Provisioning State -->
  <row>
    <panel>
      <title>Provisioning State Distribution</title>
      <chart>
        <search>
          <query>
            index=security_defender_easm sourcetype=defender:easm:discovery_template
            | stats count by provisioning_state
            | sort - count
          </query>
          <earliest>-90d</earliest>
          <latest>now</latest>
        </search>
        <option name="charting.chart">bar</option>
        <option name="charting.axisTitleX.text">Provisioning State</option>
        <option name="charting.axisTitleY.text">Template Count</option>
      </chart>
    </panel>
  </row>

  <!-- Change Activity -->
  <row>
    <panel>
      <title>Discovery Template Change Activity</title>
      <table>
        <search>
          <query>
            index=security_defender_easm sourcetype=defender:easm:discovery_template
            | sort - last_modified_time
            | table
                last_modified_time
                template_name
                modified_by
                provisioning_state
          </query>
          <earliest>-30d</earliest>
          <latest>now</latest>
        </search>
        <option name="count">15</option>
      </table>
    </panel>
  </row>

</dashboard>
