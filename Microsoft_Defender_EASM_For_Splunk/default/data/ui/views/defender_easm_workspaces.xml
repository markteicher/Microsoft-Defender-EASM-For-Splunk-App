<!-- default/data/ui/views/defender_easm_workspaces.xml -->
<!-- Microsoft Defender EASM for Splunk App -->
<!-- Control Plane â€“ Workspaces -->

<dashboard version="1.1" theme="light">
  <label>Workspaces</label>

  <description>
    Microsoft Defender EASM workspaces discovered via the control plane API.
    Displays workspace metadata, provisioning state, and system ownership details.
  </description>

  <!-- ========================= -->
  <!-- Workspace Provisioning Summary -->
  <!-- ========================= -->
  <row>
    <panel>
      <title>Workspace Provisioning States</title>
      <chart>
        <search>
          <query>
            `easm_index`
            sourcetype=defender:easm:workspaces
            | eval provisioning_state=properties.provisioningState
            | stats count by provisioning_state
          </query>
        </search>
        <option name="charting.chart">pie</option>
        <option name="legend.placement">right</option>
      </chart>
    </panel>
  </row>

  <!-- ========================= -->
  <!-- Workspace Inventory -->
  <!-- ========================= -->
  <row>
    <panel>
      <title>EASM Workspaces</title>
      <table>
        <search>
          <query>
            `easm_index`
            sourcetype=defender:easm:workspaces
            | eval provisioning_state=properties.provisioningState
            | eval created_by=systemData.createdBy
            | eval created_by_type=systemData.createdByType
            | eval created_at=systemData.createdAt
            | eval modified_by=systemData.lastModifiedBy
            | eval modified_at=systemData.lastModifiedAt
            | table
                name
                location
                provisioning_state
                created_by
                created_by_type
                created_at
                modified_by
                modified_at
                id
          </query>
        </search>

        <!-- Drilldown to Workspace Detail -->
        <drilldown>
          <link>
            <![CDATA[
              /app/microsoft_defender_easm/defender_easm_workspace_detail?form.workspace_name=$row.name$
            ]]>
          </link>
        </drilldown>

        <option name="wrap">true</option>
        <option name="count">20</option>
      </table>
    </panel>
  </row>

  <!-- ========================= -->
  <!-- Workspace Geography -->
  <!-- ========================= -->
  <row>
    <panel>
      <title>Workspaces by Location</title>
      <chart>
        <search>
          <query>
            `easm_index`
            sourcetype=defender:easm:workspaces
            | stats count by location
            | sort - count
          </query>
        </search>
        <option name="charting.chart">bar</option>
        <option name="charting.axisTitleX.text">Azure Region</option>
        <option name="charting.axisTitleY.text">Workspace Count</option>
        <option name="legend.placement">none</option>
      </chart>
    </panel>
  </row>

</dashboard>
