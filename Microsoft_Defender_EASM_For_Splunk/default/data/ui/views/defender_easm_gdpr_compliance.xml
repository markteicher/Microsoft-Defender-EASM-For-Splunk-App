<!--
  File: defender_easm_gdpr_compliance.xml
  Purpose: Dashboards â†’ GDPR Compliance
-->

<dashboard version="1.1">
  <label>GDPR Compliance</label>

  <description>
    GDPR-relevant exposure insights derived from Microsoft Defender EASM
    exposure intelligence. This view highlights assets and exposures that
    may pose personal data protection risks.
  </description>

  <!-- ========================= -->
  <!-- BASE SEARCH -->
  <!-- ========================= -->
  <search id="base_gdpr">
    <query>
      `easm_index`
      sourcetype=defender:easm:exposure_insight
      | eval
          severity=coalesce(severity, riskLevel),
          asset_type=coalesce(assetType, relatedAssetType)
    </query>
    <earliest>-30d@d</earliest>
    <latest>now</latest>
  </search>

  <!-- ========================= -->
  <!-- KPI SUMMARY -->
  <!-- ========================= -->
  <row>
    <panel>
      <single>
        <title>Total GDPR-Relevant Exposures</title>
        <search base="base_gdpr">
          <query>| stats count</query>
        </search>
      </single>
    </panel>

    <panel>
      <single>
        <title>High Severity</title>
        <search base="base_gdpr">
          <query>
            | search severity="High"
            | stats count
          </query>
        </search>
      </single>
    </panel>

    <panel>
      <single>
        <title>Medium Severity</title>
        <search base="base_gdpr">
          <query>
            | search severity="Medium"
            | stats count
          </query>
        </search>
      </single>
    </panel>

    <panel>
      <single>
        <title>Low Severity</title>
        <search base="base_gdpr">
          <query>
            | search severity="Low"
            | stats count
          </query>
        </search>
      </single>
    </panel>
  </row>

  <!-- ========================= -->
  <!-- SEVERITY DISTRIBUTION -->
  <!-- ========================= -->
  <row>
    <panel>
      <title>GDPR Exposure by Severity</title>
      <chart>
        <search base="base_gdpr">
          <query>
            | stats count by severity
          </query>
        </search>
        <option name="charting.chart">column</option>
        <option name="charting.legend.placement">right</option>
      </chart>
    </panel>
  </row>

  <!-- ========================= -->
  <!-- EXPOSURE BY ASSET TYPE -->
  <!-- ========================= -->
  <row>
    <panel>
      <title>GDPR Exposure by Asset Type</title>
      <chart>
        <search base="base_gdpr">
          <query>
            | stats count by asset_type
          </query>
        </search>
        <option name="charting.chart">pie</option>
        <option name="charting.legend.placement">right</option>
      </chart>
    </panel>
  </row>

  <!-- ========================= -->
  <!-- RISK TREND -->
  <!-- ========================= -->
  <row>
    <panel>
      <title>GDPR Exposure Trend</title>
      <chart>
        <search base="base_gdpr">
          <query>
            | timechart span=1d count by severity
          </query>
        </search>
        <option name="charting.chart">line</option>
        <option name="charting.legend.placement">right</option>
      </chart>
    </panel>
  </row>

  <!-- ========================= -->
  <!-- TOP EXPOSURE TYPES -->
  <!-- ========================= -->
  <row>
    <panel>
      <title>Top GDPR-Relevant Exposure Types</title>
      <table>
        <search base="base_gdpr">
          <query>
            | stats count by insightType
            | sort - count
            | head 10
          </query>
        </search>
        <option name="count">10</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>

</dashboard>
