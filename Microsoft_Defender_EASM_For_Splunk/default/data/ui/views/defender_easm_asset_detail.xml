<!--
  File: defender_easm_asset_detail.xml
  Microsoft Defender EASM for Splunk App

  Purpose:
  Detailed view of a single asset resource discovered by Microsoft Defender
  External Attack Surface Management.

  Source:
  Assets â€“ Get Asset Resource (data-plane)
-->

<dashboard version="1.1">
  <label>Asset Detail</label>

  <description>
    Detailed metadata, lifecycle state, discovery context, and raw payload
    for a single Defender EASM asset resource.
  </description>

  <!-- ========================= -->
  <!-- DRILLDOWN TOKEN -->
  <!-- ========================= -->
  <init>
    <set token="easm_id">$form.easm_id$</set>
  </init>

  <!-- ========================= -->
  <!-- ASSET SUMMARY -->
  <!-- ========================= -->
  <row>
    <panel>
      <title>Asset Summary</title>
      <table>
        <search>
          <query>
            `easm_index`
            sourcetype=defender:easm:asset
            easm_id="$easm_id$"
            | table
                easm_id
                asset_type
                name
                state
                discovery_source
          </query>
        </search>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>

  <!-- ========================= -->
  <!-- LIFECYCLE TIMELINE -->
  <!-- ========================= -->
  <row>
    <panel>
      <title>Lifecycle Information</title>
      <table>
        <search>
          <query>
            `easm_index`
            sourcetype=defender:easm:asset
            easm_id="$easm_id$"
            | table
                first_seen
                last_seen
                created_time
                last_updated_time
          </query>
        </search>
        <option name="wrap">true</option>
      </table>
    </panel>

    <panel>
      <title>Asset State</title>
      <single>
        <search>
          <query>
            `easm_index`
            sourcetype=defender:easm:asset
            easm_id="$easm_id$"
            | stats values(state) AS state
          </query>
        </search>
        <option name="underLabel">Current State</option>
      </single>
    </panel>
  </row>

  <!-- ========================= -->
  <!-- DISCOVERY CONTEXT -->
  <!-- ========================= -->
  <row>
    <panel>
      <title>Discovery Context</title>
      <table>
        <search>
          <query>
            `easm_index`
            sourcetype=defender:easm:asset
            easm_id="$easm_id$"
            | table
                discovery_source
                discovery_method
                discovery_task_id
                discovery_template
          </query>
        </search>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>

  <!-- ========================= -->
  <!-- RELATIONSHIP FIELDS -->
  <!-- ========================= -->
  <row>
    <panel>
      <title>Relationships & Identifiers</title>
      <table>
        <search>
          <query>
            `easm_index`
            sourcetype=defender:easm:asset
            easm_id="$easm_id$"
            | table
                subscription_id
                resource_group
                workspace_name
                external_id
          </query>
        </search>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>

  <!-- ========================= -->
  <!-- RAW ASSET PAYLOAD -->
  <!-- ========================= -->
  <row>
    <panel>
      <title>Raw Asset Event</title>
      <event>
        <search>
          <query>
            `easm_index`
            sourcetype=defender:easm:asset
            easm_id="$easm_id$"
          </query>
        </search>
        <option name="count">1</option>
        <option name="wrap">true</option>
      </event>
    </panel>
  </row>

</dashboard>
