<!-- defender_easm_asset_detail.xml -->
<!-- Microsoft Defender EASM for Splunk App -->
<!-- Asset Detail (Cross-Type) -->

<dashboard version="1.1">
  <label>Asset Detail</label>

  <description>
    Detailed view of a single asset resource discovered by Microsoft Defender
    External Attack Surface Management. This view supports all EASM asset types.
  </description>

  <!-- ========================= -->
  <!-- DRILLDOWN TOKEN -->
  <!-- ========================= -->
  <init>
    <set token="easm_id">$form.easm_id$</set>
  </init>

  <!-- ========================= -->
  <!-- ASSET SUMMARY -->
  <!-- ========================= -->
  <row>
    <panel>
      <title>Asset Summary</title>
      <table>
        <search>
          <query>
            `easm_index`
            `easm_assets_sourcetypes`
            easm_id="$easm_id$"
            | eval asset_type=coalesce(asset_type, assetType, sourcetype)
            | table
                easm_id
                asset_type
                sourcetype
                name
                domain
                host
                ip_address
          </query>
        </search>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>

  <!-- ========================= -->
  <!-- LIFECYCLE INFORMATION -->
  <!-- ========================= -->
  <row>
    <panel>
      <title>Lifecycle Information</title>
      <table>
        <search>
          <query>
            `easm_index`
            `easm_assets_sourcetypes`
            easm_id="$easm_id$"
            | eval
                first_seen=coalesce(firstSeenDateTime, discoveredDate, createdDate),
                last_seen=coalesce(lastSeenDateTime, observedDate, lastUpdatedDate)
            | table
                first_seen
                last_seen
                createdDate
                lastUpdatedDate
          </query>
        </search>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>

  <!-- ========================= -->
  <!-- DISCOVERY CONTEXT (BEST-EFFORT) -->
  <!-- ========================= -->
  <row>
    <panel>
      <title>Discovery Context</title>
      <table>
        <search>
          <query>
            `easm_index`
            `easm_assets_sourcetypes`
            easm_id="$easm_id$"
            | table
                discoverySource
                discoveryMethod
                discoveryTaskId
          </query>
        </search>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>

  <!-- ========================= -->
  <!-- RAW ASSET PAYLOAD -->
  <!-- ========================= -->
  <row>
    <panel>
      <title>Raw Asset Event</title>
      <event>
        <search>
          <query>
            `easm_index`
            `easm_assets_sourcetypes`
            easm_id="$easm_id$"
          </query>
        </search>
        <option name="count">1</option>
        <option name="wrap">true</option>
      </event>
    </panel>
  </row>

</dashboard>
