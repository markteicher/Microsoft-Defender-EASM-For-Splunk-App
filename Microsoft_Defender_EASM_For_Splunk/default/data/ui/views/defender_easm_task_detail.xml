<!-- default/data/ui/views/defender_easm_task_detail.xml -->
<!-- Microsoft Defender EASM for Splunk App -->
<!-- Task Detail Drilldown -->

<dashboard version="1.1" theme="light">
  <label>Task Detail</label>

  <description>
    Detailed execution view for a single Microsoft Defender EASM task,
    including timing, status transitions, and error diagnostics.
  </description>

  <!-- ========================= -->
  <!-- DRILLDOWN TOKEN -->
  <!-- ========================= -->
  <init>
    <set token="task_id">$task_id$</set>
  </init>

  <!-- ========================= -->
  <!-- TASK OVERVIEW -->
  <!-- ========================= -->
  <row>
    <panel>
      <title>Task Overview</title>
      <table>
        <search>
          <query>
            `easm_index`
            sourcetype=defender:easm:task
            taskId="$task_id$"
            | eval
                start_epoch=strptime(startTime,"%Y-%m-%dT%H:%M:%S"),
                end_epoch=strptime(endTime,"%Y-%m-%dT%H:%M:%S")
            | eval
                duration_seconds=if(isnull(end_epoch),null(),round(end_epoch-start_epoch,2))
            | table
                taskId
                taskType
                status
                duration_seconds
                startTime
                endTime
                createdBy
          </query>
        </search>
        <option name="wrap">true</option>
        <option name="count">1</option>
      </table>
    </panel>
  </row>

  <!-- ========================= -->
  <!-- TASK STATUS TIMELINE -->
  <!-- ========================= -->
  <row>
    <panel>
      <title>Task Status Timeline</title>
      <chart>
        <search>
          <query>
            `easm_index`
            sourcetype=defender:easm:task
            taskId="$task_id$"
            | timechart span=5m count by status
          </query>
        </search>
        <option name="charting.chart">line</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.axisTitleX.text">Time</option>
        <option name="charting.axisTitleY.text">Status Events</option>
      </chart>
    </panel>
  </row>

  <!-- ========================= -->
  <!-- FAILURE DETAILS -->
  <!-- ========================= -->
  <row>
    <panel>
      <title>Failure Details</title>
      <table>
        <search>
          <query>
            `easm_index`
            sourcetype=defender:easm:task
            taskId="$task_id$"
            | where status="Failed" OR status="Error"
            | table
                failureReason
                errorCode
                errorMessage
          </query>
        </search>
        <option name="wrap">true</option>
        <option name="count">5</option>
      </table>
    </panel>
  </row>

  <!-- ========================= -->
  <!-- RAW TASK EVENT -->
  <!-- ========================= -->
  <row>
    <panel>
      <title>Raw Task Event</title>
      <event>
        <search>
          <query>
            `easm_index`
            sourcetype=defender:easm:task
            taskId="$task_id$"
          </query>
        </search>
        <option name="list.drilldown">none</option>
        <option name="maxLines">200</option>
      </event>
    </panel>
  </row>

</dashboard>
