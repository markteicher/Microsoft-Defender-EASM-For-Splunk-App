<!-- default/data/ui/views/defender_easm_workspace_detail.xml -->
<!-- Microsoft Defender EASM for Splunk App -->
<!-- Workspace Detail Dashboard -->

<dashboard version="1.1">
  <label>Workspace Details</label>

  <!-- Drilldown Token -->
  <init>
    <set token="workspace_name">$form.workspace_name$</set>
  </init>

  <!-- ============================= -->
  <!-- Workspace Summary -->
  <!-- ============================= -->
  <row>
    <panel>
      <title>Workspace Summary</title>
      <table>
        <search>
          <query>
            `easm_index`
            sourcetype=defender:easm:workspace
            | search name="$workspace_name$"
            | eval provisioning_state=properties.provisioningState
            | table name location provisioning_state id
          </query>
        </search>
        <option name="count">5</option>
      </table>
    </panel>
  </row>

  <!-- ============================= -->
  <!-- Provisioning & Location -->
  <!-- ============================= -->
  <row>
    <panel>
      <title>Provisioning State</title>
      <single>
        <search>
          <query>
            `easm_index`
            sourcetype=defender:easm:workspace
            | search name="$workspace_name$"
            | eval provisioning_state=properties.provisioningState
            | stats values(provisioning_state) AS state
          </query>
        </search>
        <option name="underLabel">Current Status</option>
      </single>
    </panel>

    <panel>
      <title>Workspace Location</title>
      <single>
        <search>
          <query>
            `easm_index`
            sourcetype=defender:easm:workspace
            | search name="$workspace_name$"
            | stats values(location) AS region
          </query>
        </search>
        <option name="underLabel">Azure Region</option>
      </single>
    </panel>
  </row>

  <!-- ============================= -->
  <!-- Workspace Metadata -->
  <!-- ============================= -->
  <row>
    <panel>
      <title>Workspace Metadata</title>
      <table>
        <search>
          <query>
            `easm_index`
            sourcetype=defender:easm:workspace
            | search name="$workspace_name$"
            | eval subscription_id=mvindex(split(id,"/"),2)
            | eval resource_group=mvindex(split(id,"/"),4)
            | table name subscription_id resource_group id
          </query>
        </search>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>

  <!-- ============================= -->
  <!-- System Metadata (ARM) -->
  <!-- ============================= -->
  <row>
    <panel>
      <title>System Metadata</title>
      <table>
        <search>
          <query>
            `easm_index`
            sourcetype=defender:easm:workspace
            | search name="$workspace_name$"
            | eval created_by=systemData.createdBy
            | eval created_at=systemData.createdAt
            | eval modified_by=systemData.lastModifiedBy
            | eval modified_at=systemData.lastModifiedAt
            | table created_by created_at modified_by modified_at
          </query>
        </search>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>

</dashboard>
