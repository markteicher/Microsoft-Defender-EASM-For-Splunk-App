<!-- defender_easm_billable_assets.xml -->
<!-- Microsoft Defender EASM for Splunk App -->
<!-- Dashboard: Billable Assets (Manage → Billable Assets) -->

<dashboard version="1.1">
  <label>Billable Assets</label>
  <description>
    View billable asset counts and trends based on Microsoft Defender EASM billing logic.
    Counts reflect the last 30 days of observed activity.
  </description>

  <!-- Time Picker -->
  <fieldset submitButton="false">
    <input type="time" token="time">
      <label>Time Range</label>
      <default>
        <earliest>-30d@d</earliest>
        <latest>now</latest>
      </default>
    </input>
  </fieldset>

  <!-- KPI Row -->
  <row>
    <panel>
      <single>
        <title>Total Billable Assets</title>
        <search>
          <query>
            index=security_defender_easm sourcetype=defender:easm:billable
            | stats count as total
          </query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
      </single>
    </panel>

    <panel>
      <single>
        <title>Hosts</title>
        <search>
          <query>
            index=security_defender_easm sourcetype=defender:easm:billable asset_type=host
            | stats count
          </query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
      </single>
    </panel>

    <panel>
      <single>
        <title>Domains</title>
        <search>
          <query>
            index=security_defender_easm sourcetype=defender:easm:billable asset_type=domain
            | stats count
          </query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
      </single>
    </panel>

    <panel>
      <single>
        <title>IP Addresses</title>
        <search>
          <query>
            index=security_defender_easm sourcetype=defender:easm:billable asset_type=ip
            | stats count
          </query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
      </single>
    </panel>
  </row>

  <!-- 30-Day Trend -->
  <row>
    <panel>
      <chart>
        <title>Billable Assets – 30 Day Trend</title>
        <search>
          <query>
            index=security_defender_easm sourcetype=defender:easm:billable
            | timechart span=1d count by asset_type
          </query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="charting.chart">column</option>
        <option name="charting.stackMode">stacked</option>
        <option name="charting.legend.placement">bottom</option>
      </chart>
    </panel>
  </row>

  <!-- Detail Table -->
  <row>
    <panel>
      <table>
        <title>Billable Asset Details</title>
        <search>
          <query>
            index=security_defender_easm sourcetype=defender:easm:billable
            | table _time asset_type asset_name ip_address domain host
            | sort -_time
          </query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="count">20</option>
      </table>
    </panel>
  </row>

</dashboard>
