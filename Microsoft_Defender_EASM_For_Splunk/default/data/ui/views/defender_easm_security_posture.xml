<!-- defender_easm_security_posture.xml -->
<!-- Microsoft Defender EASM for Splunk App -->
<!-- Dashboard: Security Posture -->

<dashboard version="1.1">
  <label>Security Posture</label>

  <description>
    High-level security posture overview derived from Microsoft Defender
    External Attack Surface Management findings and asset exposure.
  </description>

  <!-- ========================= -->
  <!-- BASE SEARCH -->
  <!-- ========================= -->
  <search id="posture_base">
    <query>
      `easm_index`
      sourcetype=defender:easm:findings
    </query>
    <earliest>-30d@d</earliest>
    <latest>now</latest>
  </search>

  <!-- ========================= -->
  <!-- OVERALL SECURITY POSTURE -->
  <!-- ========================= -->
  <row>

    <panel>
      <title>Total Assets Evaluated</title>
      <single>
        <search>
          <query>
            `easm_index`
            sourcetype=defender:easm:assets
            | stats count
          </query>
        </search>
      </single>
    </panel>

    <panel>
      <title>Assets With Findings</title>
      <single>
        <search base="posture_base">
          <query>
            | stats dc(assetId)
          </query>
        </search>
      </single>
    </panel>

    <panel>
      <title>Critical Posture Issues</title>
      <single>
        <search base="posture_base">
          <query>
            | search severity=critical
            | stats count
          </query>
        </search>
      </single>
    </panel>

    <panel>
      <title>High Posture Issues</title>
      <single>
        <search base="posture_base">
          <query>
            | search severity=high
            | stats count
          </query>
        </search>
      </single>
    </panel>

  </row>

  <!-- ========================= -->
  <!-- FINDINGS BY SEVERITY -->
  <!-- ========================= -->
  <row>
    <panel>
      <title>Findings by Severity</title>
      <chart>
        <search base="posture_base">
          <query>
            | stats count by severity
            | sort -count
          </query>
        </search>
        <option name="charting.chart">bar</option>
      </chart>
    </panel>
  </row>

  <!-- ========================= -->
  <!-- POSTURE BY ASSET TYPE -->
  <!-- ========================= -->
  <row>
    <panel>
      <title>Posture Issues by Asset Type</title>
      <chart>
        <search base="posture_base">
          <query>
            | stats count by assetType
            | sort -count
          </query>
        </search>
        <option name="charting.chart">pie</option>
      </chart>
    </panel>
  </row>

  <!-- ========================= -->
  <!-- SECURITY POSTURE TREND -->
  <!-- ========================= -->
  <row>
    <panel>
      <title>Security Posture Trend</title>
      <chart>
        <search base="posture_base">
          <query>
            | timechart span=1d count by severity
          </query>
        </search>
        <option name="charting.chart">line</option>
        <option name="charting.legend.placement">right</option>
      </chart>
    </panel>
  </row>

  <!-- ========================= -->
  <!-- TOP POSTURE WEAKNESSES -->
  <!-- ========================= -->
  <row>
    <panel>
      <title>Top Security Weaknesses</title>
      <table>
        <search base="posture_base">
          <query>
            | stats count by findingType
            | sort -count
            | head 10
          </query>
        </search>
        <option name="count">10</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>

</dashboard>
