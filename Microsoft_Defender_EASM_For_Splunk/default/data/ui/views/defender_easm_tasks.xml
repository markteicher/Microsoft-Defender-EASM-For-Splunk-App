<!-- default/data/ui/views/defender_easm_tasks.xml -->
<!-- Microsoft Defender EASM for Splunk App -->
<!-- Tasks Dashboard -->

<dashboard version="1.1" theme="light">
  <label>Tasks</label>

  <description>
    Execution status, duration, and outcomes for Microsoft Defender EASM tasks.
  </description>

  <!-- ========================= -->
  <!-- Task Summary -->
  <!-- ========================= -->
  <row>
    <panel>
      <title>Task Status Summary</title>
      <chart>
        <search>
          <query>
            index=security_defender_easm sourcetype=defender:easm:task
            | stats count by status
          </query>
        </search>
        <option name="charting.chart">pie</option>
        <option name="legend.placement">right</option>
      </chart>
    </panel>
  </row>

  <!-- ========================= -->
  <!-- Task Execution Duration -->
  <!-- ========================= -->
  <row>
    <panel>
      <title>Task Execution Duration</title>
      <chart>
        <search>
          <query>
            index=security_defender_easm sourcetype=defender:easm:task
            | eval duration_seconds = round((endTime - startTime),2)
            | timechart span=1h avg(duration_seconds)
          </query>
        </search>
        <option name="charting.chart">line</option>
        <option name="legend.placement">none</option>
      </chart>
    </panel>
  </row>

  <!-- ========================= -->
  <!-- Task Table (Drilldown Enabled) -->
  <!-- ========================= -->
  <row>
    <panel>
      <title>Task Details</title>
      <table>
        <search>
          <query>
            index=security_defender_easm sourcetype=defender:easm:task
            | eval duration_seconds = round((endTime - startTime),2)
            | table taskId taskType status duration_seconds startTime endTime createdBy
          </query>
        </search>

        <!-- DRILLDOWN -->
        <drilldown>
          <link>
            <![CDATA[
              /app/microsoft_defender_easm/defender_easm_task_detail?task_id=$row.taskId$
            ]]>
          </link>
        </drilldown>

        <option name="wrap">true</option>
        <option name="count">25</option>
      </table>
    </panel>
  </row>

  <!-- ========================= -->
  <!-- Failed Tasks -->
  <!-- ========================= -->
  <row>
    <panel>
      <title>Failed Tasks</title>
      <table>
        <search>
          <query>
            index=security_defender_easm sourcetype=defender:easm:task status="Failed"
            | table taskId taskType failureReason errorCode startTime endTime
          </query>
        </search>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>

</dashboard>
